\hypertarget{i2c_8h}{}\doxysection{i2c.\+h File Reference}
\label{i2c_8h}\index{i2c.h@{i2c.h}}


This file contains the definitions of the functions used to communicate with the e-\/covid sensor.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include \char`\"{}driver/i2c.\+h\char`\"{}}\newline
Include dependency graph for i2c.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=220pt]{i2c_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=208pt]{i2c_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structI2c__Sensor__State}{I2c\+\_\+\+Sensor\+\_\+\+State}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{i2c_8h_ad1ffbcada0fc81acf8ea7f67a5a4420d}\label{i2c_8h_ad1ffbcada0fc81acf8ea7f67a5a4420d}} 
\#define {\bfseries I2\+C\+\_\+\+USED}~I2\+C\+\_\+\+NUM\+\_\+0
\item 
\mbox{\Hypertarget{i2c_8h_af47631d568bba17edf9d1ea042602bb6}\label{i2c_8h_af47631d568bba17edf9d1ea042602bb6}} 
\#define {\bfseries I2\+C\+\_\+\+MASTER\+\_\+\+SDA\+\_\+\+IO}~21
\item 
\mbox{\Hypertarget{i2c_8h_a033b5e8a30541fe4ff939a62fdb7a43d}\label{i2c_8h_a033b5e8a30541fe4ff939a62fdb7a43d}} 
\#define {\bfseries I2\+C\+\_\+\+MASTER\+\_\+\+SCL\+\_\+\+IO}~22
\item 
\mbox{\Hypertarget{i2c_8h_a64323822a120b1aa18f861f2e8055661}\label{i2c_8h_a64323822a120b1aa18f861f2e8055661}} 
\#define {\bfseries I2\+C0\+\_\+\+FREQUENCY\+\_\+\+HZ}~50000
\item 
\mbox{\Hypertarget{i2c_8h_ae2cc5418f947ac10bd79b831ea4ab94b}\label{i2c_8h_ae2cc5418f947ac10bd79b831ea4ab94b}} 
\#define {\bfseries MLX90614\+\_\+\+DEFAULT\+\_\+\+ADDRESS}~    0x5A
\item 
\mbox{\Hypertarget{i2c_8h_ac864dad4e8a12c299ad742f19d29ea51}\label{i2c_8h_ac864dad4e8a12c299ad742f19d29ea51}} 
\#define {\bfseries MAX32664\+\_\+\+DEFAULT\+\_\+\+ADDRESS}~    0x55
\item 
\mbox{\Hypertarget{i2c_8h_af3cb636c3c001bc8361e5673c5e7de44}\label{i2c_8h_af3cb636c3c001bc8361e5673c5e7de44}} 
\#define {\bfseries ACQ\+\_\+\+I2\+C\+\_\+\+SAMPLE\+\_\+\+RATE}~10
\item 
\mbox{\Hypertarget{i2c_8h_a9d60c84bb3d6581a7b803c5f18528941}\label{i2c_8h_a9d60c84bb3d6581a7b803c5f18528941}} 
\#define {\bfseries CONFIDENCE\+\_\+\+THRESHOLD}~    90
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{i2c_8h_af31f0b997d365cdd0ad925d2695ba398}{i2c\+Master\+Init}} (void)
\begin{DoxyCompactList}\small\item\em i2c master initialization \end{DoxyCompactList}\item 
int \mbox{\hyperlink{i2c_8h_ae3171470c23d5e2358b750c0b94d9cd1}{MLX90614\+\_\+\+SMBus\+Read}} (uint8\+\_\+t slave\+Addr, uint8\+\_\+t reg\+\_\+addr, uint16\+\_\+t $\ast$data)
\begin{DoxyCompactList}\small\item\em Read data from MLX90614. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{i2c_8h_a84d9791903d3f10d0918e15469b61b99}{MLX90614\+\_\+\+Calc\+PEC}} (uint8\+\_\+t init\+PEC, uint8\+\_\+t new\+Data)
\begin{DoxyCompactList}\small\item\em Calculate PEC for MLX90614. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{i2c_8h_ab524e7ae80ce65702ddfb2b3d3a9979c}{MLX90614\+\_\+\+Get\+Temp\+Amb}} (uint8\+\_\+t slave\+Addr, float $\ast$temp\+\_\+amb, uint16\+\_\+t $\ast$temp\+\_\+amb\+\_\+int)
\begin{DoxyCompactList}\small\item\em Get ambient temperature from MLX90614. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{i2c_8h_a9940a5b0514467c6b38ac69486edc4ab}{MLX90614\+\_\+\+Get\+Temp\+Obj}} (uint8\+\_\+t slave\+Addr, float $\ast$temp\+\_\+obj, uint16\+\_\+t $\ast$temp\+\_\+obj\+\_\+int)
\begin{DoxyCompactList}\small\item\em Get object temperature from MLX90614. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{i2c_8h_aba4c5527f6b1485d2479d67b42c375c1}{MAX32664\+\_\+\+SMBus\+Read}} (uint8\+\_\+t slave\+\_\+addr, uint8\+\_\+t family\+\_\+byte, uint8\+\_\+t index\+\_\+byte, uint8\+\_\+t extra\+\_\+byte, uint8\+\_\+t extra\+\_\+byte\+\_\+flag, uint8\+\_\+t $\ast$rcv\+\_\+data, uint8\+\_\+t rcv\+\_\+data\+\_\+size, uint8\+\_\+t delay\+\_\+ms)
\begin{DoxyCompactList}\small\item\em MAX32664 SMBus read function. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{i2c_8h_ab23a0de89f7653802f6fa621e59a5d74}{MAX32664\+\_\+\+SMBus\+Write}} (uint8\+\_\+t slave\+\_\+addr, uint8\+\_\+t family\+\_\+byte, uint8\+\_\+t index\+\_\+byte, uint8\+\_\+t $\ast$write\+\_\+data, uint8\+\_\+t write\+\_\+data\+\_\+size, uint8\+\_\+t delay\+\_\+ms)
\begin{DoxyCompactList}\small\item\em MAX32664 SMBus write function. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{i2c_8h_aaf711ea2c9db8dbc43aa164c93b2a6ff}{MAX32664\+\_\+\+Init}} (void)
\begin{DoxyCompactList}\small\item\em MAX32664 initialization. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{i2c_8h_a3067e350605188bfc92ad7e33564d4d5}{MAX32664\+\_\+\+Config}} (void)
\begin{DoxyCompactList}\small\item\em Implements the necessary configurations in order to read HR+\+Sp\+O2. \end{DoxyCompactList}\item 
uint8\+\_\+t \mbox{\hyperlink{i2c_8h_a62e621e938b99bcd1762bb1dbaa92b57}{MAX32664\+\_\+\+Get\+BPM}} (uint16\+\_\+t $\ast$heart\+\_\+rate, uint16\+\_\+t $\ast$oxygen, uint8\+\_\+t $\ast$confidence, uint8\+\_\+t $\ast$status)
\begin{DoxyCompactList}\small\item\em Reads the HR values from the MAX32664. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
This file contains the definitions of the functions used to communicate with the e-\/covid sensor. 

This file contains the definitions of the functions used to communicate with the e-\/covid sensor through the I2C bus. It is specific to the e-\/covid sensor and the I2C bus used in the project. It is not a generic I2C driver. Not used anymore. 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{i2c_8h_af31f0b997d365cdd0ad925d2695ba398}\label{i2c_8h_af31f0b997d365cdd0ad925d2695ba398}} 
\index{i2c.h@{i2c.h}!i2cMasterInit@{i2cMasterInit}}
\index{i2cMasterInit@{i2cMasterInit}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{i2cMasterInit()}{i2cMasterInit()}}
{\footnotesize\ttfamily esp\+\_\+err\+\_\+t i2c\+Master\+Init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



i2c master initialization 

\begin{DoxyReturn}{Returns}
\+:
\begin{DoxyItemize}
\item ESP\+\_\+\+OK Success
\item ESP\+\_\+\+ERR\+\_\+\+INVALID\+\_\+\+ARG Parameter error
\item ESP\+\_\+\+FAIL Driver install error 
\end{DoxyItemize}
\end{DoxyReturn}
\texorpdfstring{$<$}{<} Internal GPIO pull mode for I2C sda signal

\texorpdfstring{$<$}{<} Internal GPIO pull mode for I2C scl signal\mbox{\Hypertarget{i2c_8h_a3067e350605188bfc92ad7e33564d4d5}\label{i2c_8h_a3067e350605188bfc92ad7e33564d4d5}} 
\index{i2c.h@{i2c.h}!MAX32664\_Config@{MAX32664\_Config}}
\index{MAX32664\_Config@{MAX32664\_Config}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MAX32664\_Config()}{MAX32664\_Config()}}
{\footnotesize\ttfamily uint8\+\_\+t MAX32664\+\_\+\+Config (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Implements the necessary configurations in order to read HR+\+Sp\+O2. 

Implements the necessary configurations in order to read HR+\+Sp\+O2. Based on page 13 of \char`\"{}\+Measuring Heart Rate and Sp\+O2\+Using the MAX32664\+A –   A Quick \+Start Guide\char`\"{} \href{https://pdfserv.maximintegrated.com/en/an/ug7087-max32664a-quick-start-guide-rev-1-p1.pdf}{\texttt{ https\+://pdfserv.\+maximintegrated.\+com/en/an/ug7087-\/max32664a-\/quick-\/start-\/guide-\/rev-\/1-\/p1.\+pdf}}

\begin{DoxyReturn}{Returns}
\+:
\begin{DoxyItemize}
\item 0 Success
\item 1 Error 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{i2c_8h_a62e621e938b99bcd1762bb1dbaa92b57}\label{i2c_8h_a62e621e938b99bcd1762bb1dbaa92b57}} 
\index{i2c.h@{i2c.h}!MAX32664\_GetBPM@{MAX32664\_GetBPM}}
\index{MAX32664\_GetBPM@{MAX32664\_GetBPM}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MAX32664\_GetBPM()}{MAX32664\_GetBPM()}}
{\footnotesize\ttfamily uint8\+\_\+t MAX32664\+\_\+\+Get\+BPM (\begin{DoxyParamCaption}\item[{uint16\+\_\+t $\ast$}]{heart\+\_\+rate,  }\item[{uint16\+\_\+t $\ast$}]{oxygen,  }\item[{uint8\+\_\+t $\ast$}]{confidence,  }\item[{uint8\+\_\+t $\ast$}]{status }\end{DoxyParamCaption})}



Reads the HR values from the MAX32664. 

Reads the HR+\+Sp\+O2 values from the MAX32664. Based on page 13 of \char`\"{}\+Measuring \+Heart Rate and Sp\+O2\+Using the MAX32664\+A –   A Quick Start Guide\char`\"{} \href{https://pdfserv.maximintegrated.com/en/an/ug7087-max32664a-quick-start-guide-rev-1-p1.pdf}{\texttt{ https\+://pdfserv.\+maximintegrated.\+com/en/an/ug7087-\/max32664a-\/quick-\/start-\/guide-\/rev-\/1-\/p1.\+pdf}}


\begin{DoxyParams}{Parameters}
{\em heart\+\_\+rate} & Pointer to the variable where the heart rate value will be stored.\\
\hline
{\em oxygen} & Pointer to the variable where the Sp\+O2 value will be stored.\\
\hline
{\em confidence} & Pointer to the variable where the confidence value will be stored.\\
\hline
{\em status} & Pointer to the variable where the status value will be stored.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+:
\begin{DoxyItemize}
\item 0 Success
\item 1 Error 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{i2c_8h_aaf711ea2c9db8dbc43aa164c93b2a6ff}\label{i2c_8h_aaf711ea2c9db8dbc43aa164c93b2a6ff}} 
\index{i2c.h@{i2c.h}!MAX32664\_Init@{MAX32664\_Init}}
\index{MAX32664\_Init@{MAX32664\_Init}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MAX32664\_Init()}{MAX32664\_Init()}}
{\footnotesize\ttfamily void MAX32664\+\_\+\+Init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



MAX32664 initialization. 

MAX32664 is a sensor that measures heart rate and Sp\+O2. It is connected to the ESP32 through the I2C bus. \mbox{\Hypertarget{i2c_8h_aba4c5527f6b1485d2479d67b42c375c1}\label{i2c_8h_aba4c5527f6b1485d2479d67b42c375c1}} 
\index{i2c.h@{i2c.h}!MAX32664\_SMBusRead@{MAX32664\_SMBusRead}}
\index{MAX32664\_SMBusRead@{MAX32664\_SMBusRead}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MAX32664\_SMBusRead()}{MAX32664\_SMBusRead()}}
{\footnotesize\ttfamily int MAX32664\+\_\+\+SMBus\+Read (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{slave\+\_\+addr,  }\item[{uint8\+\_\+t}]{family\+\_\+byte,  }\item[{uint8\+\_\+t}]{index\+\_\+byte,  }\item[{uint8\+\_\+t}]{extra\+\_\+byte,  }\item[{uint8\+\_\+t}]{extra\+\_\+byte\+\_\+flag,  }\item[{uint8\+\_\+t $\ast$}]{rcv\+\_\+data,  }\item[{uint8\+\_\+t}]{rcv\+\_\+data\+\_\+size,  }\item[{uint8\+\_\+t}]{delay\+\_\+ms }\end{DoxyParamCaption})}



MAX32664 SMBus read function. 


\begin{DoxyParams}{Parameters}
{\em slave\+\_\+addr} & Slave address of the MAX32664. \\
\hline
{\em family\+\_\+byte} & Family byte of the command. \\
\hline
{\em index\+\_\+byte} & Index byte of the command. \\
\hline
{\em extra\+\_\+byte} & Extra byte of the command. \\
\hline
{\em extra\+\_\+byte\+\_\+flag} & Flag to indicate if the extra byte is used or not. \\
\hline
{\em rcv\+\_\+data} & Pointer to the buffer where the data will be stored. \\
\hline
{\em rcv\+\_\+data\+\_\+size} & Size of recieving data of interest. Normally the slave sends 1 byte for \char`\"{}\+Read status byte\char`\"{} followed by the data of interest (Total recieved bytes should be always more than 1 byte -\/\texorpdfstring{$>$}{>} status byte + data of interest)\\
\hline
{\em delay\+\_\+ms} & Delay in ms between the write and read commands.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+:
\begin{DoxyItemize}
\item 0 Success
\item 1 Error 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{i2c_8h_ab23a0de89f7653802f6fa621e59a5d74}\label{i2c_8h_ab23a0de89f7653802f6fa621e59a5d74}} 
\index{i2c.h@{i2c.h}!MAX32664\_SMBusWrite@{MAX32664\_SMBusWrite}}
\index{MAX32664\_SMBusWrite@{MAX32664\_SMBusWrite}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MAX32664\_SMBusWrite()}{MAX32664\_SMBusWrite()}}
{\footnotesize\ttfamily int MAX32664\+\_\+\+SMBus\+Write (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{slave\+\_\+addr,  }\item[{uint8\+\_\+t}]{family\+\_\+byte,  }\item[{uint8\+\_\+t}]{index\+\_\+byte,  }\item[{uint8\+\_\+t $\ast$}]{write\+\_\+data,  }\item[{uint8\+\_\+t}]{write\+\_\+data\+\_\+size,  }\item[{uint8\+\_\+t}]{delay\+\_\+ms }\end{DoxyParamCaption})}



MAX32664 SMBus write function. 


\begin{DoxyParams}{Parameters}
{\em slave\+\_\+addr} & Slave address of the MAX32664. \\
\hline
{\em family\+\_\+byte} & Family byte of the command. \\
\hline
{\em index\+\_\+byte} & Index byte of the command. \\
\hline
{\em write\+\_\+data} & Pointer to the buffer where the data to be written is stored.\\
\hline
{\em write\+\_\+data\+\_\+size} & Size of the data to be written.\\
\hline
{\em delay\+\_\+ms} & Delay in ms between the write and read commands.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+:
\begin{DoxyItemize}
\item 0 Success
\item 1 Error 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{i2c_8h_a84d9791903d3f10d0918e15469b61b99}\label{i2c_8h_a84d9791903d3f10d0918e15469b61b99}} 
\index{i2c.h@{i2c.h}!MLX90614\_CalcPEC@{MLX90614\_CalcPEC}}
\index{MLX90614\_CalcPEC@{MLX90614\_CalcPEC}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MLX90614\_CalcPEC()}{MLX90614\_CalcPEC()}}
{\footnotesize\ttfamily uint8\+\_\+t MLX90614\+\_\+\+Calc\+PEC (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{init\+PEC,  }\item[{uint8\+\_\+t}]{new\+Data }\end{DoxyParamCaption})}



Calculate PEC for MLX90614. 


\begin{DoxyParams}{Parameters}
{\em init\+PEC} & Initial PEC value. \\
\hline
{\em new\+Data} & New data to calculate PEC.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
PEC value. 
\end{DoxyReturn}
\mbox{\Hypertarget{i2c_8h_ab524e7ae80ce65702ddfb2b3d3a9979c}\label{i2c_8h_ab524e7ae80ce65702ddfb2b3d3a9979c}} 
\index{i2c.h@{i2c.h}!MLX90614\_GetTempAmb@{MLX90614\_GetTempAmb}}
\index{MLX90614\_GetTempAmb@{MLX90614\_GetTempAmb}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MLX90614\_GetTempAmb()}{MLX90614\_GetTempAmb()}}
{\footnotesize\ttfamily int MLX90614\+\_\+\+Get\+Temp\+Amb (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{slave\+Addr,  }\item[{float $\ast$}]{temp\+\_\+amb,  }\item[{uint16\+\_\+t $\ast$}]{temp\+\_\+amb\+\_\+int }\end{DoxyParamCaption})}



Get ambient temperature from MLX90614. 


\begin{DoxyParams}{Parameters}
{\em slave\+\_\+addr} & Slave address of the MLX90614. \\
\hline
{\em temp\+\_\+amb} & Pointer to the variable where the ambient temperature will be stored.\\
\hline
{\em temp\+\_\+amb\+\_\+int} & Pointer to the variable where the ambient temperature in integer format will be stored.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+:
\begin{DoxyItemize}
\item 0 Success
\item 1 Error 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{i2c_8h_a9940a5b0514467c6b38ac69486edc4ab}\label{i2c_8h_a9940a5b0514467c6b38ac69486edc4ab}} 
\index{i2c.h@{i2c.h}!MLX90614\_GetTempObj@{MLX90614\_GetTempObj}}
\index{MLX90614\_GetTempObj@{MLX90614\_GetTempObj}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MLX90614\_GetTempObj()}{MLX90614\_GetTempObj()}}
{\footnotesize\ttfamily int MLX90614\+\_\+\+Get\+Temp\+Obj (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{slave\+Addr,  }\item[{float $\ast$}]{temp\+\_\+obj,  }\item[{uint16\+\_\+t $\ast$}]{temp\+\_\+obj\+\_\+int }\end{DoxyParamCaption})}



Get object temperature from MLX90614. 


\begin{DoxyParams}{Parameters}
{\em slave\+\_\+addr} & Slave address of the MLX90614. \\
\hline
{\em temp\+\_\+obj} & Pointer to the variable where the object temperature will be stored.\\
\hline
{\em temp\+\_\+obj\+\_\+int} & Pointer to the variable where the object temperature in integer format will be stored.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+:
\begin{DoxyItemize}
\item 0 Success
\item 1 Error 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{i2c_8h_ae3171470c23d5e2358b750c0b94d9cd1}\label{i2c_8h_ae3171470c23d5e2358b750c0b94d9cd1}} 
\index{i2c.h@{i2c.h}!MLX90614\_SMBusRead@{MLX90614\_SMBusRead}}
\index{MLX90614\_SMBusRead@{MLX90614\_SMBusRead}!i2c.h@{i2c.h}}
\doxysubsubsection{\texorpdfstring{MLX90614\_SMBusRead()}{MLX90614\_SMBusRead()}}
{\footnotesize\ttfamily int MLX90614\+\_\+\+SMBus\+Read (\begin{DoxyParamCaption}\item[{uint8\+\_\+t}]{slave\+Addr,  }\item[{uint8\+\_\+t}]{reg\+\_\+addr,  }\item[{uint16\+\_\+t $\ast$}]{data }\end{DoxyParamCaption})}



Read data from MLX90614. 


\begin{DoxyParams}{Parameters}
{\em slave\+\_\+addr} & Slave address of the MLX90614. \\
\hline
{\em reg\+\_\+addr} & Register address to read. \\
\hline
{\em data} & Pointer to the variable where the data will be stored.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\+:
\begin{DoxyItemize}
\item 0 Success
\item 1 Error 
\end{DoxyItemize}
\end{DoxyReturn}
